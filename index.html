<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BookKaro - Insights Dashboard</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAL-LDI6qvDPqVWNL_tNb53D7kacbpAlAw",
            authDomain: "bookkaro-f549a.firebaseapp.com",
            projectId: "bookkaro-f549a",
            storageBucket: "bookkaro-f549a.firebasestorage.app",
            messagingSenderId: "1067243117950",
            appId: "1:1067243117950:web:c7682b0aca89d0c0a0272f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        onSnapshot(collection(db, "bookings"), (snap) => {
            let stats = { Approved: 0, Rejected: 0, Alternate: 0, Pending: 0 };
            let props = {};
            let locations = {};

            snap.forEach(d => {
                const b = d.data();
                stats[b.status]++;
                props[b.propertyType] = (props[b.propertyType] || 0) + 1;
                locations[b.stayLoc] = (locations[b.stayLoc] || 0) + 1;
            });

            document.getElementById('metrics').innerHTML = `
                <div class="stat-card">Total: ${snap.size}</div>
                <div class="stat-card">Approved: ${stats.Approved}</div>
                <div class="stat-card">Rejected: ${stats.Rejected}</div>
                <div class="stat-card">Alts: ${stats.Alternate}</div>
            `;

            let propHtml = '<strong>Popularity by Type:</strong><br>';
            for(let p in props) propHtml += `${p}: ${props[p]} requests<br>`;
            document.getElementById('propBox').innerHTML = propHtml;

            let locHtml = '<strong>Demand by Location:</strong><br>';
            for(let l in locations) locHtml += `${l}: ${locations[l]} bookings<br>`;
            document.getElementById('locBox').innerHTML = locHtml;
        });
    </script>
    <style>
        body { background: #f1f8e9; color: #2e7d32; font-family: sans-serif; padding: 20px; }
        .stat-card { display: inline-block; width: 22%; background: #5d4037; color: white; padding: 20px; text-align: center; border-radius: 10px; margin: 1%; font-size: 1.2em; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        .box { background: white; border: 2px solid #8d6e63; padding: 20px; border-radius: 10px; }
        h1 { border-bottom: 3px solid #5d4037; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>BookKaro Insights ðŸ“Š</h1>
    <div id="metrics"></div>
    <div class="data-grid">
        <div class="box" id="propBox">Analyzing property trends...</div>
        <div class="box" id="locBox">Analyzing geographical demand...</div>
    </div>
</body>
</html>
