<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BookKaro - Insights</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAL-LDI6qvDPqVWNL_tNb53D7kacbpAlAw",
            authDomain: "bookkaro-f549a.firebaseapp.com",
            projectId: "bookkaro-f549a",
            storageBucket: "bookkaro-f549a.firebasestorage.app",
            messagingSenderId: "1067243117950",
            appId: "1:1067243117950:web:c7682b0aca89d0c0a0272f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        onSnapshot(collection(db, "bookings"), (snap) => {
            let stats = { Approved: 0, Rejected: 0, Alternate: 0 };
            let props = {};
            let locs = {};
            
            snap.forEach(d => {
                const b = d.data();
                if(stats.hasOwnProperty(b.status)) stats[b.status]++;
                props[b.propertyType] = (props[b.propertyType] || 0) + 1;
                locs[b.stayLoc] = (locs[b.stayLoc] || 0) + 1;
            });

            document.getElementById('overview').innerHTML = `
                <div class="stat-box">Approved: ${stats.Approved}</div>
                <div class="stat-box">Rejected: ${stats.Rejected}</div>
                <div class="stat-box">Alt Offers: ${stats.Alternate}</div>
            `;
            
            let propList = '<strong>Demand by Property:</strong><br>';
            for(let p in props) propList += `${p}: ${props[p]} requests<br>`;
            document.getElementById('propDemand').innerHTML = propList;

            let locList = '<strong>Top Destinations:</strong><br>';
            for(let l in locs) locList += `${l}: ${locs[l]} requests<br>`;
            document.getElementById('geoDemand').innerHTML = locList;
        });
    </script>
    <style>
        body { background: #f1f8e9; color: #2e7d32; font-family: sans-serif; padding: 30px; }
        .stat-box { display: inline-block; width: 30%; background: #5d4037; color: white; padding: 20px; text-align: center; border-radius: 10px; margin: 1%; }
        .chart-box { background: white; border: 2px solid #8d6e63; padding: 20px; border-radius: 10px; margin-top: 20px; }
        h1 { border-bottom: 2px solid #5d4037; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>BookKaro Business Dashboard ðŸ“Š</h1>
    <div id="overview"></div>
    <div class="chart-box" id="propDemand">Loading property analytics...</div>
    <div class="chart-box" id="geoDemand">Loading location trends...</div>
</body>
</html>
